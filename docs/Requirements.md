# 客服管理平台需求文档

## 1. 范围与目标
- 多角色客服平台，覆盖工单、实时会话、知识库、通知、统计、审计。
- 用户端 SSO（Keycloak），管理端精细 RBAC。

## 2. 用户故事（节选）
- 用户：SSO 登录，提交带附件的工单，查看进度并追加留言。
- 坐席：领取/被分配工单，查看上下文，使用宏回复并转派或升级。
- 管理员：配置队列/技能组/SLA/工作时间，管理角色权限，查看报表与审计日志。

## 3. 功能需求
- 身份与权限：Keycloak OIDC；角色 Admin/Agent/User；细粒度权限（工单读/写/分配、会话接入、报表）。
- 工单：创建/更新/标签/优先级/附件；自动分配（轮询/技能/负载）；状态流转与重开；SLA 计时与提醒。
- 会话：实时消息、排队、转接/协同、快速回复、用户画像；WebSocket 推送。
- 知识库：分类/标签/搜索，草稿/发布，版本记录，模版引用。
- 通知：可配置渠道与模版，触发规则（状态变更、即将超时、评价）。
- 报表：实时看板（队列/坐席/渠道），周期报表导出；数据权限隔离。
- 审计：关键操作记录（登录、权限变更、工单/会话敏感操作），可导出。

## 4. 非功能需求
- 性能：P95 接口 < 300ms；WebSocket 延迟 < 150ms（同地域）。
- 可用性：SLA 99.9%；多副本部署；健康检查与自动恢复。
- 安全：HTTPS、Token 验签、速率限制、输入校验、敏感字段加密、审计留痕。
- 可扩展：横向扩展；异步队列削峰；读写分离可选。
- 观测：结构化日志、Tracing、Metrics；错误告警。

## 5. 接口/集成概要
- SSO：Keycloak 授权码流+PKCE；用户信息同步映射角色。
- 前端 SDK：Axios + 拦截器（刷新 Token、统一错误）；WebSocket 客户端。
- 后端 API：REST/OpenAPI；WebSocket 频道（会话消息、工单更新）。
- 文件：直传（S3 预签名）；病毒扫描可选。
- 率限制：基于 Redis 按 IP/用户/资源。

## 6. 数据与合规
- MongoDB：TTL 索引清理会话日志/临时数据；备份策略；分片可选。
- 数据保留：审计/操作日志按法规（如 180 天/一年）；隐私擦除接口。

